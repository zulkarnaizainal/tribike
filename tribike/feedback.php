<?php require 'includes/db.php'; require 'includes/auth.php'; if (session_status()==PHP_SESSION_NONE) session_start(); $user = is_logged_in()? current_user($pdo): null; $error=''; $success=''; if ($_SERVER['REQUEST_METHOD']==='POST' && $user){ $msg=trim($_POST['message']??''); if($msg){ $stmt=$pdo->prepare('INSERT INTO feedback (user_id,message,created_at) VALUES (?,?,NOW())'); $stmt->execute([$user['id'],$msg]); $success='Thank you for your feedback'; } else $error='Message required'; } $all = $pdo->query('SELECT f.*, u.name FROM feedback f JOIN users u ON u.id=f.user_id ORDER BY f.id DESC')->fetchAll(); ?><!doctype html><html><head><meta charset="utf-8"><title>Feedback - Tribike</title><link rel="stylesheet" href="assets/style.css"></head><body><div class="container"><h2>Feedback</h2><?php if($error):?><p class="error"><?=htmlspecialchars($error)?></p><?php endif;?><?php if($success):?><p class="success"><?=htmlspecialchars($success)?></p><?php endif;?><?php if($user):?><form method="post"><label>Message<br><textarea name="message" required></textarea></label><br><button type="submit">Send Feedback</button></form><?php else:?><p>Please <a href="login.php">login</a> to send feedback.</p><?php endif; ?><h3>All Feedback</h3><?php foreach($all as $fb):?><div style="border:1px solid #ddd;padding:8px;margin:6px 0;"><strong><?=htmlspecialchars($fb['name'])?></strong> (<?=htmlspecialchars($fb['created_at'])?>)<br><?=nl2br(htmlspecialchars($fb['message']))?></div><?php endforeach; ?><p><a href="index.php">Back</a></p></div></body></html>