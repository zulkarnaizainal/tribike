<?php require 'includes/db.php'; require 'includes/auth.php'; if (session_status()==PHP_SESSION_NONE) session_start(); require_login(); $user=current_user($pdo); if(!$user['is_admin']) die('Access denied'); if(isset($_GET['export']) && $_GET['export']=='rentals'){ header('Content-Type: text/csv'); header('Content-Disposition: attachment; filename="rentals.csv"'); $out=fopen('php://output','w'); fputcsv($out,['id','user','bike','start_time','end_time','total_price','status']); $rows=$pdo->query('SELECT r.*, u.name AS user_name, b.model AS bike_model FROM rentals r JOIN users u ON u.id=r.user_id JOIN bikes b ON b.id=r.bike_id')->fetchAll(); foreach($rows as $r) fputcsv($out,[$r['id'],$r['user_name'],$r['bike_model'],$r['start_time'],$r['end_time'],$r['total_price'],$r['status']]); fclose($out); exit; } if(isset($_GET['export']) && $_GET['export']=='bookings'){ header('Content-Type: text/csv'); header('Content-Disposition: attachment; filename="bookings.csv"'); $out=fopen('php://output','w'); fputcsv($out,['id','user','bike','start_datetime','end_datetime','status']); $rows=$pdo->query('SELECT bk.*, u.name AS user_name, b.model AS bike_model FROM bookings bk JOIN users u ON u.id=bk.user_id JOIN bikes b ON b.id=bk.bike_id')->fetchAll(); foreach($rows as $r) fputcsv($out,[$r['id'],$r['user_name'],$r['bike_model'],$r['start_datetime'],$r['end_datetime'],$r['status']]); fclose($out); exit; } ?><!doctype html><html><head><meta charset="utf-8"><title>Reports - Tribike</title><link rel="stylesheet" href="assets/style.css"></head><body><div class="container"><h2>Admin Reports</h2><p><a href="report.php?export=rentals">Export Rentals CSV</a></p><p><a href="report.php?export=bookings">Export Bookings CSV</a></p><p><a href="admin.php">Back</a></p></div></body></html>